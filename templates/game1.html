<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MANAS AI - Snake Game</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<style>
.material-symbols-outlined {
  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 48;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem 0.5rem 2rem;
  background-color: white;
  border-bottom: 1px solid #eee;
}
.header h2 {
  font-weight: 700;
  color: #1313ec;
  font-size: 1.1rem;
  font-family: 'Inter', sans-serif;
  margin: 0;
}
#backToChat {
  background: linear-gradient(135deg, #4A47A3, #7E57C2);
  padding: 0.5rem 1.2rem;
  border-radius: 0.9rem;
  color: white;
  font-weight: 700;
  font-size: 1rem;
  border: none;
  box-shadow: 0 4px 20px rgba(50,40,150,0.06);
  transition: background 0.3s, transform 0.3s;
}
#backToChat:hover {
  background: linear-gradient(135deg, #7E57C2, #4A47A3);
  transform: scale(1.05);
}
#gameArea {
  width: 360px;
  max-width: 96vw;
  margin: 1.5rem auto 0 auto;
  background: white;
  border-radius: 1.2rem;
  box-shadow: 0 0 8px rgba(0,0,0,0.08);
  outline: none;
  overflow: visible;
  padding-bottom: 1.5rem;
}
canvas {
  display: block;
  margin: 0.8rem auto 0 auto;
  background: white;
  border-radius: 1.1rem;
  box-shadow: 0 0 8px #4a47a316;
}
#score {
  text-align: center;
  color: #5b13ec;
  font-size: 2rem;
  font-weight: 700;
  margin-top: 1.4rem;
  font-family: 'Inter', sans-serif;
}
#startBtn {
  display: block;
  margin: 1.5rem auto 0 auto;
  background: linear-gradient(135deg, #4A47A3, #7E57C2);
  color: white;
  font-weight: 700;
  padding: 0.6rem 1.6rem;
  border-radius: 1rem;
  border: none;
  cursor: pointer;
  font-size: 1.2rem;
  box-shadow: 0 6px 15px #4a47a336;
  transition: background 0.2s, transform 0.2s;
  user-select: none;
}
#startBtn:hover {
  background: linear-gradient(135deg, #7E57C2, #4A47A3);
  transform: scale(1.04);
}
.controls-wrap {
  width: 360px;
  max-width: 96vw;
  margin: 1.2rem auto 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.7rem;
}
.controls-row, .controls-3row {
  display: flex;
  justify-content: center;
  gap: 1rem;
}
button.control-btn {
  width: 3.7rem;
  height: 3.7rem;
  border-radius: 0.9rem;
  background-color: white;
  border: 1.5px solid #dad6ea;
  box-shadow: 0 0 4px #724de32f;
  font-weight: bold;
  color: #333;
  font-size: 2rem;
  cursor: pointer;
  transition: background 0.18s, color 0.18s;
  display: flex;
  justify-content: center;
  align-items: center;
}
button.control-btn:active {
  background: #edeaff;
  color: #5b13ec;
}
.material-symbols-outlined.control-icon {
  font-size: 2.25rem;
  pointer-events: none;
}
</style>
</head>
<body class="font-display bg-background-light">
<header class="header">
  <h2>MANAS AI - Snake Game</h2>
  <button id="backToChat">Back to Chat</button>
</header>
<div id="gameArea" tabindex="0" aria-label="Snake Game">
  <canvas id="gameCanvas" width="360" height="360"></canvas>
  <div id="score">Score: 0</div>
  <button id="startBtn">Start Game</button>
  <div class="controls-wrap">
    <div class="controls-row">
      <button class="control-btn" id="btnUp" aria-label="Move Up"><span class="material-symbols-outlined control-icon">keyboard_arrow_up</span></button>
    </div>
    <div class="controls-3row">
      <button class="control-btn" id="btnLeft" aria-label="Move Left"><span class="material-symbols-outlined control-icon">keyboard_arrow_left</span></button>
      <button class="control-btn" id="btnDown" aria-label="Move Down"><span class="material-symbols-outlined control-icon">keyboard_arrow_down</span></button>
      <button class="control-btn" id="btnRight" aria-label="Move Right"><span class="material-symbols-outlined control-icon">keyboard_arrow_right</span></button>
    </div>
  </div>
</div>
<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreDisplay = document.getElementById('score');
  const startBtn = document.getElementById('startBtn');
  const backToChatBtn = document.getElementById('backToChat');
  const btnUp = document.getElementById('btnUp');
  const btnLeft = document.getElementById('btnLeft');
  const btnDown = document.getElementById('btnDown');
  const btnRight = document.getElementById('btnRight');
  const gridSize = 20;
  const tileSize = canvas.width / gridSize;
  let snake = [{x: 10, y: 10}];
  let direction = {x: 1, y: 0};
  let food = {x: 15, y: 15};
  let gameLoopId = null;
  let score = 0;
  function updateServerScore(scoreValue) {
    fetch('/update_score', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({game: 'snake', score: scoreValue})
    })
    .then(res => res.json())
    .then(data => {
      if (data.total !== undefined) {
        scoreDisplay.textContent = 'Score: ' + scoreValue + ' | Total: ' + data.total;
      }
    });
  }
  function gameOver() {
    clearInterval(gameLoopId);
    alert('Game Over! Score: ' + score);
    updateServerScore(score);
  }
  function placeFood() {
    food.x = Math.floor(Math.random() * gridSize);
    food.y = Math.floor(Math.random() * gridSize);
    while(snake.some(segment => segment.x === food.x && segment.y === food.y)) {
      food.x = Math.floor(Math.random() * gridSize);
      food.y = Math.floor(Math.random() * gridSize);
    }
  }
  function drawBlock(x, y, color, radius = 6) {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(x * tileSize + radius, y * tileSize);
    ctx.lineTo(x * tileSize + tileSize - radius, y * tileSize);
    ctx.quadraticCurveTo(x * tileSize + tileSize, y * tileSize, x * tileSize + tileSize, y * tileSize + radius);
    ctx.lineTo(x * tileSize + tileSize, y * tileSize + tileSize - radius);
    ctx.quadraticCurveTo(x * tileSize + tileSize, y * tileSize + tileSize, x * tileSize + tileSize - radius, y * tileSize + tileSize);
    ctx.lineTo(x * tileSize + radius, y * tileSize + tileSize);
    ctx.quadraticCurveTo(x * tileSize, y * tileSize + tileSize, x * tileSize, y * tileSize + tileSize - radius);
    ctx.lineTo(x * tileSize, y * tileSize + radius);
    ctx.quadraticCurveTo(x * tileSize, y * tileSize, x * tileSize + radius, y * tileSize);
    ctx.fill();
  }
  function drawSnake() {
    snake.forEach((segment, idx) => {
      drawBlock(segment.x, segment.y, idx === 0 ? '#4A47A3' : '#6D55AA');
    });
  }
  function drawFood() {
    drawBlock(food.x, food.y, '#FF4B4B', 7);
  }
  function moveSnake() {
    const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
    if (head.x < 0 || head.x >= gridSize || head.y < 0 || head.y >= gridSize) { gameOver(); return false; }
    if (snake.some(segment => segment.x === head.x && segment.y === head.y)) { gameOver(); return false; }
    snake.unshift(head);
    if (head.x === food.x && head.y === food.y) {
      score++;
      scoreDisplay.textContent = 'Score: ' + score;
      updateServerScore(score);
      placeFood();
    } else {
      snake.pop();
    }
    return true;
  }
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawSnake();
    drawFood();
  }
  function gameLoop() {
    if(moveSnake()) { draw(); }
  }
  function changeDirection(e) {
    const key = e.key;
    if (key === 'ArrowUp' && direction.y !== 1) direction = {x: 0, y: -1};
    else if (key === 'ArrowDown' && direction.y !== -1) direction = {x: 0, y: 1};
    else if (key === 'ArrowLeft' && direction.x !== 1) direction = {x: -1, y: 0};
    else if (key === 'ArrowRight' && direction.x !== -1) direction = {x: 1, y: 0};
  }
  startBtn.onclick = () => {
    if(gameLoopId) clearInterval(gameLoopId);
    snake = [{x: 10, y: 10}];
    direction = {x: 1, y: 0};
    score = 0;
    scoreDisplay.textContent = 'Score: ' + score;
    placeFood();
    draw();
    gameLoopId = setInterval(gameLoop, 160);
    document.getElementById('gameArea').focus();
  };
  backToChatBtn.onclick = () => { window.location.href = '/chat'; };
  btnUp.onclick = () => { if(direction.y !== 1) direction = {x: 0, y: -1}; };
  btnDown.onclick = () => { if(direction.y !== -1) direction = {x: 0, y: 1}; };
  btnLeft.onclick = () => { if(direction.x !== 1) direction = {x: -1, y: 0}; };
  btnRight.onclick = () => { if(direction.x !== -1) direction = {x: 1, y: 0}; };
  document.addEventListener('keydown', changeDirection);
  window.onload = () => document.getElementById('gameArea').focus();
})();
</script>
</body>
</html>
